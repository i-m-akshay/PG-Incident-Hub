<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PG Incident Hub</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">
  <header class="bg-blue-600 text-white p-4 shadow">
    <h1 class="text-2xl font-bold">PG Incident Hub</h1>
  </header>

  <main class="flex-1 container mx-auto p-4">
    <div class="flex">
      <!-- Sidebar -->
      <aside class="w-64 bg-white rounded-xl shadow p-4 hidden md:block">
        <h2 class="text-lg font-semibold mb-2">Categories</h2>
        <ul id="sidebarCategories" class="space-y-2"></ul>
      </aside>

      <!-- Main Content -->
      <section class="flex-1 md:ml-6">
        <div id="incidentContainer" class="space-y-6"></div>
      </section>
    </div>
  </main>

  <!-- Scroll buttons -->
  <button id="scrollTopBtn" class="hidden fixed bottom-20 right-4 bg-blue-600 text-white p-3 rounded-full shadow-lg">↑</button>
  <button id="scrollBottomBtn" class="hidden fixed bottom-4 right-4 bg-blue-600 text-white p-3 rounded-full shadow-lg">↓</button>

  <!-- Success popup -->
  <div id="copySuccess" class="hidden fixed bottom-28 right-4 bg-green-500 text-white px-4 py-2 rounded shadow">Copied!</div>

  <script>
    // Incident data
    const incidentsData = {
      "Upsell": [
        {
          title: "Tier Completion (after session 47)",
          description: "Encourage parent to continue enrollment after 47th session.",
          to: "support@example.com",
          cc: "",
          subject: "Tier Completion Guidance",
          body: "Dear Parent, congratulations on reaching session 47..."
        }
      ],
      "Pause related": [
        {
          title: "Parent Informed Pause",
          description: "Handle parent request to pause classes.",
          to: "support@example.com",
          cc: "",
          subject: "Pause Request",
          body: "Dear Parent, we acknowledge your request to pause classes..."
        }
      ]
    };

    // Render sidebar categories
    const sidebarCategories = document.getElementById('sidebarCategories');
    const incidentContainer = document.getElementById('incidentContainer');

    function renderIncidents() {
      sidebarCategories.innerHTML = '';
      incidentContainer.innerHTML = '';

      Object.keys(incidentsData).forEach(category => {
        // Sidebar item
        const li = document.createElement('li');
        li.textContent = category;
        li.className = 'cursor-pointer text-blue-600 hover:underline';
        li.onclick = () => document.getElementById(`cat-${category}`).scrollIntoView({behavior:'smooth'});
        sidebarCategories.appendChild(li);

        // Category block
        const div = document.createElement('div');
        div.id = `cat-${category}`;
        div.className = 'bg-white p-4 rounded-xl shadow';

        const h3 = document.createElement('h3');
        h3.className = 'text-xl font-semibold mb-2';
        h3.textContent = category;
        div.appendChild(h3);

        incidentsData[category].forEach(incident => {
          const card = document.createElement('div');
          card.className = 'border rounded p-3 mb-3';

          const title = document.createElement('h4');
          title.className = 'font-bold';
          title.textContent = incident.title;

          const desc = document.createElement('p');
          desc.className = 'text-gray-600';
          desc.textContent = incident.description;

          const btnCopy = document.createElement('button');
          btnCopy.className = 'bg-gray-200 px-2 py-1 rounded mr-2';
          btnCopy.textContent = 'Copy Draft Message';
          btnCopy.onclick = () => copyToClipboard(incident.body);

          const btnEmail = document.createElement('a');
          btnEmail.href = `mailto:${incident.to}?cc=${incident.cc}&subject=${encodeURIComponent(incident.subject)}&body=${encodeURIComponent(incident.body)}`;
          btnEmail.className = 'bg-blue-600 text-white px-2 py-1 rounded';
          btnEmail.textContent = 'Compose Email';

          card.appendChild(title);
          card.appendChild(desc);
          card.appendChild(btnCopy);
          card.appendChild(btnEmail);
          div.appendChild(card);
        });

        incidentContainer.appendChild(div);
      });
    }

    function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(() => {
        const popup = document.getElementById('copySuccess');
        popup.classList.remove('hidden');
        setTimeout(() => popup.classList.add('hidden'), 2000);
      });
    }

    // Scroll buttons
    const scrollTopBtn = document.getElementById('scrollTopBtn');
    const scrollBottomBtn = document.getElementById('scrollBottomBtn');

    window.addEventListener('scroll', () => {
      if (window.scrollY > 300) {
        scrollTopBtn.classList.remove('hidden');
      } else {
        scrollTopBtn.classList.add('hidden');
      }
      if (window.innerHeight + window.scrollY < document.body.offsetHeight - 300) {
        scrollBottomBtn.classList.remove('hidden');
      } else {
        scrollBottomBtn.classList.add('hidden');
      }
    });

    scrollTopBtn.onclick = () => window.scrollTo({ top: 0, behavior: 'smooth' });
    scrollBottomBtn.onclick = () => window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });

    renderIncidents();
  </script>
</body>
</html>
